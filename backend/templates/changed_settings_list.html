<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Changed Device Settings</title>
  <link rel="icon" href="{{ url_for('static', filename='logo.jpg') }}" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <div class="position-relative">
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary mb-3">Back to Dashboard</a>
    <h1>Changed Device Settings</h1>
  </div>

  <form class="mb-4" method="get" action="{{ url_for('changed_settings_list') }}">
    <div class="accordion" id="filterAccordion">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
            Filter
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#filterAccordion">
          <div class="accordion-body">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">Month (e.g., 1 for Jan)</label> <!-- Filters by submitted_at month -->
                <input type="text" name="month" class="form-control" placeholder="6" value="{{ query_params.get('month', '') }}">
              </div>
              <div class="col-md-3">
                <label class="form-label">Year</label> <!-- Filters by submitted_at year -->
                <input type="number" name="year" class="form-control" placeholder="2025" value="{{ query_params.get('year', '') }}">
              </div>
              <div class="col-md-3">
                <label class="form-label">Company</label>
                <input type="text" name="company" class="form-control" placeholder="ABC Corp" value="{{ query_params.get('company', '') }}">
              </div>
              <div class="col-md-3">
                <label class="form-label">User</label>
                <input type="text" name="user" class="form-control" placeholder="admin1" value="{{ query_params.get('user', '') }}">
              </div>
              <div class="col-md-3 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">Filter</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </form>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-striped table-bordered">
      <thead class="table-dark">
        <tr>
          <th>User</th>
          <th>Company</th>
          <th>Date of Change</th> <!-- This is 'date' from the form -->
          <th>Submitted Month</th> <!-- From 'submitted_at' -->
          <th>Submitted Day</th>   <!-- From 'submitted_at' -->
          <th>Premises</th>
          <th>Devices</th>
          <th>Change Scent</th>
          <th>Scent To</th>
          <th>Redo Settings</th>
          <th>Reduce Intensity</th>
          <th>Increase Intensity</th>
          <th>Move Device</th>
          <th>Move Device To</th>
          <th>Relocate Device</th>
          <th>Relocate Device To</th>
          <th>Remark</th>
        </tr>
      </thead>
      <tbody>
        {% for row in data %}
        <tr>
          <td>{{ row.user }}</td>
          <td>{{ row.company }}</td>
          <td>{{ row.date }}</td>
          <td>{{ row.submitted_month }}</td>
          <td>{{ row.submitted_day }}</td>
          <td>{{ row.premises | join(', ') if row.premises else '' }}</td>
          <td>{{ row.devices | join(', ') if row.devices else '' }}</td>
          <td>{{ row.change_scent }}</td>
          <td>{{ row.change_scent_to }}</td>
          <td>{{ row.redo_settings }}</td>
          <td>{{ row.reduce_intensity }}</td>
          <td>{{ row.increase_intensity }}</td>
          <td>{{ row.move_device }}</td>
          <td>{{ row.move_device_to }}</td>
          <td>{{ row.relocate_device }}</td>
          <td>{{ row.relocate_device_to }}</td>
          <td>{{ row.remark }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="17" class="text-center">No records found.</td> <!-- Adjusted colspan -->
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if total_pages > 1 %}
  <nav>
    <ul class="pagination justify-content-center mt-4">
      <li class="page-item {% if page == 1 %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('changed_settings_list', page=page-1, **query_params) }}">&laquo;</a>
      </li>
      {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('changed_settings_list', page=p, **query_params) }}">{{ p }}</a>
        </li>
      {% endfor %}
      <li class="page-item {% if page == total_pages %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('changed_settings_list', page=page+1, **query_params) }}">&raquo;</a>
      </li>
    </ul>
  </nav>
  {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
