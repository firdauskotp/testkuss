{% extends "base.html" %}

{% block title %}EO & Model Lists{% endblock %}
{% block page_title %}Essential Oil & Device Model Lists{% endblock %}

{% block head_extra %}
    {# Any page-specific CSS or JS links for this page #}
{% endblock %}

{% block content %}
<div class="py-8 px-4 sm:px-6 lg:px-8 space-y-12">

    <div class="text-left mb-6">
        <a href="{{ url_for('dashboard') }}"
           class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900">
            &larr; Back to Dashboard
        </a>
    </div>

    <!-- Section 1: EO List - Data -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-6 sm:p-8">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">EO List - Data</h2>
        <button id="eoFilterToggleButton" class="w-full flex justify-between items-center py-3 px-4 text-left text-lg font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700/50 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
            <span>Show/Hide Filters</span><svg id="eoFilterToggleIcon" class="w-5 h-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        </button>
        <div id="eoFilterFormContainer" class="hidden mb-6">
            <form method="get" action="{{ url_for('data_reports.eo_list_func') }}" class="space-y-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-x-6 gap-y-4">
                    {% for name, label, placeholder, type in [
                        ('month', 'Month', '10', 'text'),
                        ('year', 'Year', '2024', 'number'),
                        ('EO', 'EO Name', 'Black Opium', 'text'),
                        ('Volume', 'Volume', '10', 'number')
                    ] %}
                    <div>
                        <label for="eo_filter_{{ name }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ label }}</label>
                        <input type="{{ type }}" id="eo_filter_{{ name }}" name="{{ name }}" value="{{ request.args.get(name, '') }}" placeholder="{{ placeholder }}" class="tailwind-input-class">
                    </div>
                    {% endfor %}
                </div>
                <div class="pt-4 flex justify-end"><button type="submit" class="tailwind-button-blue">Filter EO List</button></div>
            </form>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        {% for header in ['', 'EO', 'Volume', 'Month', 'Year'] %}
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap">{{ header }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                {% for row in data %} {# Assuming 'data' is for EO List #}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['EO1'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['EO2'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['Volume'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['month'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['year'] }}</td>
                    </tr>
                {% else %}
                    <tr><td colspan="5" class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-gray-400">No EO data available.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% if total_pages > 1 %}
        {% include 'partials/pagination.html' %}
        {% endif %}
    </div>

    <!-- Section 2: Model List - Data -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-6 sm:p-8">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Model List - Data</h2>
        <button id="modelFilterToggleButton" class="w-full flex justify-between items-center py-3 px-4 text-left text-lg font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700/50 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
            <span>Show/Hide Filters</span><svg id="modelFilterToggleIcon" class="w-5 h-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        </button>
        <div id="modelFilterFormContainer" class="hidden mb-6">
            <form method="get" action="{{ url_for('data_reports.eo_list_func') }}" class="space-y-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4">
                    {% for name, label, placeholder, type in [
                        ('model_month', 'Month', '10', 'text'),
                        ('model_year', 'Year', '2024', 'number'),
                        ('Quantity', 'Quantity', '10', 'number'),
                        ('total_batteries', 'Total Batteries', '10', 'number'),
                        ('model_type', 'Model', 'ASH', 'text'),
                        ('battery_type', 'Battery Type', 'Panasonic', 'text'),
                        ('Remark', 'Remark', 'Every Month', 'text')
                    ] %}
                    <div>
                        <label for="model_filter_{{ name }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ label }}</label>
                        <input type="{{ type }}" id="model_filter_{{ name }}" name="{{ name }}" value="{{ request.args.get(name, '') }}" placeholder="{{ placeholder }}" class="tailwind-input-class">
                    </div>
                    {% endfor %}
                </div>
                <div class="pt-4 flex justify-end"><button type="submit" class="tailwind-button-blue">Filter Model List</button></div>
            </form>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                <thead class="bg-gray-50 dark:bg-gray-700">
                    <tr>
                        {% for header in ['', 'Model', 'Quantity', 'Total Batteries', 'Battery Type', 'Remark', 'Month', 'Year'] %}
                        <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap">{{ header }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                {% for row in model_data %} {# Assuming 'model_data' is for Model List #}
                    <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['model1'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['model2'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['quantity'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['total_batteries'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['battery_type'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['remark'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['month'] }}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['year'] }}</td>
                    </tr>
                {% else %}
                    <tr><td colspan="8" class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-gray-400">No model data available.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% if total_model_pages > 1 %}
        <nav aria-label="Page navigation" class="mt-6 flex flex-col gap-2 align-center justify-center">
            <ul class="flex items-center space-x-1">
                <li>
                    {% if model_page > 1 %}
                        <a href="{{ pagination_base_url_model }}{{ query_params_model | to_querystring | update_querystring('model_page', model_page - 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </span>
                    {% endif %}
                </li>
                {% for p in range(max(1, model_page - 2), min(total_model_pages + 1, model_page + 3)) %}
                <li>
                    {% if p == model_page %}
                        <span class="px-3 py-2 text-sm leading-tight text-blue-600 bg-blue-50 border border-blue-300 font-medium dark:bg-gray-700 dark:border-gray-600 dark:text-white">{{ p }}</span>
                    {% else %}
                        <a href="{{ pagination_base_url_model }}{{ query_params_model | to_querystring | update_querystring('model_page', p) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">{{ p }}</a>
                    {% endif %}
                </li>
                {% endfor %}
                <li>
                    {% if model_page < total_model_pages %}
                        <a href="{{ pagination_base_url_model }}{{ query_params_model | to_querystring | update_querystring('model_page', model_page + 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </span>
                    {% endif %}
                </li>
            </ul>
            
            <div class="mt-4 text-sm text-gray-700 dark:text-gray-400 text-center">
                Showing page {{ model_page }} of {{ total_model_pages }}
            </div>
        </nav>
        {% endif %}
    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
    // Common Tailwind classes (already defined in base.html or can be redefined if needed)
    const tailwindInputClass = "appearance-none block w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 dark:focus:ring-offset-gray-900 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700/50 text-gray-900 dark:text-gray-50";
    const tailwindButtonBlue = "py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900";
    const tailwindPaginationButton = "py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white";
    const tailwindPaginationActive = "text-blue-600 bg-blue-50 border-blue-300 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white";
    const tailwindPaginationDisabled = "opacity-50 cursor-not-allowed";

    document.addEventListener('DOMContentLoaded', function () {
        function setupFilterToggle(buttonId, formContainerId, iconId) {
            const toggleButton = document.getElementById(buttonId);
            const formContainer = document.getElementById(formContainerId);
            const toggleIcon = document.getElementById(iconId);

            if (toggleButton && formContainer && toggleIcon) {
                 // Set initial state based on whether any filters are active (optional)
                let params = new URLSearchParams(window.location.search);
                let filterActive = false;
                formContainer.querySelectorAll('input, select').forEach(input => {
                    // Check if the input's name corresponds to a query parameter for its specific section
                    // This requires knowing which query params belong to which filter form.
                    // For simplicity, just check if ANY filter is active for now to open all.
                    // A more refined approach would be to pass section-specific query params to check.
                    if (params.has(input.name) && params.get(input.name) !== '') {
                        filterActive = true;
                    }
                });
                // If any filter is active on the page, open this specific filter section.
                // This is a broad check; specific check would be better if params are unique per form.
                if (filterActive && formContainer.querySelector(`input[name='${Array.from(params.keys())[0]}']`)) { // A bit of a heuristic
                    formContainer.classList.remove('hidden');
                    toggleIcon.classList.add('rotate-180');
                }


                toggleButton.addEventListener('click', () => {
                    formContainer.classList.toggle('hidden');
                    toggleIcon.classList.toggle('rotate-180');
                });
            }
        }

        setupFilterToggle('eoFilterToggleButton', 'eoFilterFormContainer', 'eoFilterToggleIcon');
        setupFilterToggle('modelFilterToggleButton', 'modelFilterFormContainer', 'modelFilterToggleIcon');

        document.querySelectorAll('form input, form select').forEach(el => {
             if (!el.classList.contains('tailwind-input-class') && el.type !== 'submit' && el.type !== 'button') {
                el.classList.add(...tailwindInputClass.split(' '));
            }
        });
        document.querySelectorAll('form button[type="submit"]').forEach(el => {
            if (!el.classList.contains('tailwind-button-blue')) {
                el.classList.add(...tailwindButtonBlue.split(' '));
            }
        });

        document.querySelectorAll('nav[aria-label="Page navigation"] ul.pagination a, nav[aria-label="Page navigation"] ul.pagination span').forEach(el => {
            el.classList.remove('page-link');
            if(el.parentNode.classList.contains('disabled')) {
                 el.classList.add(...tailwindPaginationDisabled.split(' '));
            }
            if(el.parentNode.classList.contains('active')) {
                 el.classList.add(...tailwindPaginationActive.split(' '));
            }
            el.classList.add(...tailwindPaginationButton.split(' '));
             if (el.innerHTML.includes('&laquo;')) { // Previous
                el.classList.add('rounded-l-lg');
            } else if (el.innerHTML.includes('&raquo;')) { // Next
                el.classList.add('rounded-r-lg');
            }
        });
    });
</script>
{% endblock %}
