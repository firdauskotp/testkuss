{% extends "base.html" %}

{% block title %}Packing List Reports{% endblock %}
{% block page_title %}Packing List & Inventory{% endblock %}

{% block head_extra %}
    {# Any page-specific CSS or JS links for this page #}
{% endblock %}

{% block content %}
<div class="py-8 px-4 sm:px-6 lg:px-8 space-y-12"> {# Increased space between sections #}

    <div class="text-left mb-6">
        <a href="{{ url_for('dashboard') }}"
           class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 dark:focus:ring-offset-gray-900">
            &larr; Back to Dashboard
        </a>
    </div>

    {# Helper macro for filter sections and tables - this is conceptual for thought process.
       In practice, I will repeat the structure for each of the 4 sections.
       Macro definition would not work directly in create_file_with_block like this.
    #}
    {#
    {% macro render_report_section(section_title, filter_fields, table_headers, data_rows, pagination_vars, section_id_prefix) %}
        <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-6 sm:p-8">
            <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">{{ section_title }}</h2>

            <!-- Filter Form Section -->
            <button id="{{ section_id_prefix }}FilterToggleButton"
                    class="w-full flex justify-between items-center py-3 px-4 text-left text-lg font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700/50 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
                <span>Show/Hide Filters for {{ section_title }}</span>
                <svg id="{{ section_id_prefix }}FilterToggleIcon" class="w-5 h-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
            </button>
            <div id="{{ section_id_prefix }}FilterFormContainer" class="hidden mb-6">
                <form method="get" action="{{ url_for('pack_list') }}" class="space-y-6"> {# All forms point to pack-list #}
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4">
                        {% for name, label, placeholder, type in filter_fields %}
                        <div>
                            <label for="{{ section_id_prefix }}{{ name }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ label }}</label>
                            <input type="{{ type | default('text') }}" id="{{ section_id_prefix }}{{ name }}" name="{{ name }}"
                                   value="{{ request.args.get(name, '') }}" placeholder="{{ placeholder }}"
                                   class="tailwind-input-class">
                        </div>
                        {% endfor %}
                    </div>
                    <div class="pt-4 flex justify-end">
                        <button type="submit" class="tailwind-button-blue">Filter</button>
                    </div>
                </form>
            </div>

            <!-- Data Table Section -->
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                    <thead class="bg-gray-50 dark:bg-gray-700">
                        <tr>
                            {% for header in table_headers %}
                            <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap">{{ header }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
                        {% for row in data_rows %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            {% for header_key in table_headers %} {# Assuming header matches key or needs mapping #}
                                <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">
                                    {{ row[header_key.lower().replace(' ', '_')] | default(row[header_key]) | default('') }}
                                </td>
                            {% endfor %}
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="{{ table_headers|length }}" class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-gray-400">
                                No data available.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <!-- Pagination -->
            {% if data_rows and pagination_vars.total_pages > 1 %}
            <nav aria-label="Page navigation" class="mt-6 flex flex-col gap-2 align-center justify-center">
                 <ul class="inline-flex items-cente justify-center -space-x-px">
                    <li> {# Previous Button #}
                        <a href="{{ pagination_vars.base_url }}{{ pagination_vars.query_params | to_querystring | update_querystring(pagination_vars.page_arg_name, pagination_vars.current_page - 1) }}"
                           class="py-2 px-3 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white {% if pagination_vars.current_page == 1 %}opacity-50 cursor-not-allowed{% endif %}">
                            &laquo; Prev
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                    {# Page numbers - simplified for brevity, can expand as in reports.html if needed #}
                     {% for p in range(max(1, pagination_vars.current_page - 2), min(pagination_vars.total_pages + 1, pagination_vars.current_page + 3)) %}
                    <li>
                        <a href="{{ pagination_vars.base_url }}{{ pagination_vars.query_params | to_querystring | update_querystring(pagination_vars.page_arg_name, p) }}"
                           class="py-2 px-3 leading-tight border {% if p == pagination_vars.current_page %}text-blue-600 bg-blue-50 border-blue-300 dark:bg-gray-700 dark:text-white{% else %}text-gray-500 bg-white border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white{% endif %}">
                            {{ p }}
                        </a>
                    </li>
                    {% endfor %}
                    <li> {# Next Button #}
                        <a href="{{ pagination_vars.base_url }}{{ pagination_vars.query_params | to_querystring | update_querystring(pagination_vars.page_arg_name, pagination_vars.current_page + 1) }}"
                           class="py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white {% if pagination_vars.current_page == pagination_vars.total_pages %}opacity-50 cursor-not-allowed{% endif %}">
                            Next &raquo;
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
            {% endif %}
        </div>

    <!-- Section 1: EO Pack - Data -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-6 sm:p-8">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">EO Pack - Data</h2>
        <button id="eoFilterToggleButton" class="w-full flex justify-between items-center py-3 px-4 text-left text-lg font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700/50 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
            <span>Show/Hide Filters</span><svg id="eoFilterToggleIcon" class="w-5 h-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        </button>
        <div id="eoFilterFormContainer" class="hidden mb-6">
            <form method="get" action="{{ url_for('data_reports.pack_list') }}" class="space-y-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4">
                    {% for name, label, placeholder, type in [
                        ('month', 'Month', '10', 'text'), ('year', 'Year', '2024', 'number'),
                        ('eo_name', 'Essential Oil', 'Black Opium', 'text'), ('ml_required', 'ML Required', '10', 'number'),
                        ('packed', 'Packed', '10', 'number'), ('ready_supply', 'Ready Supply', '10', 'number'),
                        ('ml_fresh_supply', 'ML Fresh Supply', '10', 'number'), ('ml_balance', 'ML Balance', '10', 'number'),
                        ('perc_balance', 'Percentage Balance', '20', 'number'), ('ml_refill', 'ML Refill', '10', 'number'),
                        ('perc_refill', 'Percentage Refill', '20', 'number')
                    ] %}
                    <div><label for="eo_{{ name }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ label }}</label><input type="{{ type }}" id="eo_{{ name }}" name="{{ name }}" value="{{ request.args.get(name, '') }}" placeholder="{{ placeholder }}" class="tailwind-input-class"></div>
                    {% endfor %}
                </div>
                <div class="pt-4 flex justify-end"><button type="submit" class="tailwind-button-blue">Filter EO Pack</button></div>
            </form>
        </div>
        <div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700"><tr>{% for header in ['EO Name', 'ML Required', 'Packed', 'Ready Supply', 'ML Fresh Supply', 'ML Balance', 'Perc Balance', 'ML Refill', 'Perc Refill', 'Month', 'Year'] %}<th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap">{{ header }}</th>{% endfor %}</tr></thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            {% for row in data %} {# Assuming 'data' is for EO Pack #}
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['eo_name'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['ml_required'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['packed'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['ready_supply'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['ml_fresh_supply'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['ml_balance'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['perc_balance'] }}%</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['ml_refill'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['perc_refill'] }}%</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['month'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['year'] }}</td>
                </tr>
            {% else %}<tr><td colspan="11" class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-gray-400">No EO pack data available.</td></tr>{% endfor %}
            </tbody></table></div>
        {% if total_pages > 1 %}
        <nav aria-label="Page navigation" class="mt-6 flex  flex-col gap-2  items-center ustify-center">
            <ul class="flex items-center justify-center space-x-1">
                <li>
                    {% if page > 1 %}
                        <a href="{{ pagination_base_url }}{{ query_params | to_querystring | update_querystring('page', page - 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </span>
                    {% endif %}
                </li>
                {% for p in range(max(1, page - 2), min(total_pages + 1, page + 3)) %}
                <li>
                    {% if p == page %}
                        <span class="px-3 py-2 text-sm leading-tight text-blue-600 bg-blue-50 border border-blue-300 font-medium dark:bg-gray-700 dark:border-gray-600 dark:text-white">{{ p }}</span>
                    {% else %}
                        <a href="{{ pagination_base_url }}{{ query_params | to_querystring | update_querystring('page', p) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">{{ p }}</a>
                    {% endif %}
                </li>
                {% endfor %}
                <li>
                    {% if page < total_pages %}
                        <a href="{{ pagination_base_url }}{{ query_params | to_querystring | update_querystring('page', page + 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </span>
                    {% endif %}
                </li>
            </ul>
            
            <div class="mt-4 text-sm text-gray-700 dark:text-gray-400 text-center">
                Showing page {{ page }} of {{ total_pages }}
            </div>
        </nav>
        {% endif %}
    </div>

    <!-- Section 2: Other Device List - Data -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-6 sm:p-8">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Other Device List - Data</h2>
        <button id="otherDeviceFilterToggleButton" class="w-full flex justify-between items-center py-3 px-4 text-left text-lg font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700/50 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
            <span>Show/Hide Filters</span><svg id="otherDeviceFilterToggleIcon" class="w-5 h-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        </button>
        <div id="otherDeviceFilterFormContainer" class="hidden mb-6">
            <form method="get" action="{{ url_for('data_reports.pack_list') }}" class="space-y-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4">
                    {% for name, label, placeholder, type in [
                        ('device_month', 'Month', '10', 'text'), ('device_year', 'Year', '2024', 'number'),
                        ('devices', 'Devices', 'REED STICKS', 'text'), ('device_quantity', 'Quantity', '10', 'number')
                    ] %}
                    <div><label for="other_{{ name }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ label }}</label><input type="{{ type }}" id="other_{{ name }}" name="{{ name }}" value="{{ request.args.get(name, '') }}" placeholder="{{ placeholder }}" class="tailwind-input-class"></div>
                    {% endfor %}
                </div>
                <div class="pt-4 flex justify-end"><button type="submit" class="tailwind-button-blue">Filter Other Devices</button></div>
            </form>
        </div>
        <div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700"><tr>{% for header in ['Device', 'Quantity', 'Month', 'Year'] %}<th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap">{{ header }}</th>{% endfor %}</tr></thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            {% for row in device_data %}
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['devices'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['quantity'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['month'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['year'] }}</td>
                </tr>
            {% else %}<tr><td colspan="4" class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-gray-400">No other device data available.</td></tr>{% endfor %}
            </tbody></table></div>
        {% if total_device_pages > 1 %}
        <nav aria-label="Page navigation" class="mt-6 flex flex-col gap-2 align-center justify-center">
            <ul class="flex items-center justify-center space-x-1">
                <li>
                    {% if device_page > 1 %}
                        <a href="{{ pagination_base_url_device }}{{ query_params_device | to_querystring | update_querystring('device_page', device_page - 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </span>
                    {% endif %}
                </li>
                {% for p in range(max(1, device_page - 2), min(total_device_pages + 1, device_page + 3)) %}
                <li>
                    {% if p == device_page %}
                        <span class="px-3 py-2 text-sm leading-tight text-blue-600 bg-blue-50 border border-blue-300 font-medium dark:bg-gray-700 dark:border-gray-600 dark:text-white">{{ p }}</span>
                    {% else %}
                        <a href="{{ pagination_base_url_device }}{{ query_params_device | to_querystring | update_querystring('device_page', p) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">{{ p }}</a>
                    {% endif %}
                </li>
                {% endfor %}
                <li>
                    {% if device_page < total_device_pages %}
                        <a href="{{ pagination_base_url_device }}{{ query_params_device | to_querystring | update_querystring('device_page', device_page + 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </span>
                    {% endif %}
                </li>
            </ul>
            
            <div class="mt-4 text-sm text-gray-700 dark:text-gray-400 text-center">
                Showing page {{ device_page }} of {{ total_device_pages }}
            </div>
        </nav>
        {% endif %}
    </div>

    <!-- Section 3: Empty Bottle Pack List -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-6 sm:p-8">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Empty Bottle Pack List</h2>
        <button id="bottleFilterToggleButton" class="w-full flex justify-between items-center py-3 px-4 text-left text-lg font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700/50 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
            <span>Show/Hide Filters</span><svg id="bottleFilterToggleIcon" class="w-5 h-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        </button>
        <div id="bottleFilterFormContainer" class="hidden mb-6">
            <form method="get" action="{{ url_for('data_reports.pack_list') }}" class="space-y-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4">
                     {% for name, label, placeholder, type in [
                        ('bottle_month', 'Month', '10', 'text'), ('bottle_year', 'Year', '2024', 'number'),
                        ('empty_bottle', 'Empty Bottles', '10', 'number'), ('bottle_volume', 'Volume', '10', 'number')
                    ] %}
                    <div><label for="bottle_{{ name }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ label }}</label><input type="{{ type }}" id="bottle_{{ name }}" name="{{ name }}" value="{{ request.args.get(name, '') }}" placeholder="{{ placeholder }}" class="tailwind-input-class"></div>
                    {% endfor %}
                </div>
                <div class="pt-4 flex justify-end"><button type="submit" class="tailwind-button-blue">Filter Empty Bottles</button></div>
            </form>
        </div>
        <div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700"><tr>{% for header in ['Empty Bottles', 'Volume', 'Month', 'Year'] %}<th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap">{{ header }}</th>{% endfor %}</tr></thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            {% for row in bottle_data %}
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['empty_bottles'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['volume'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['month'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['year'] }}</td>
                </tr>
            {% else %}<tr><td colspan="4" class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-gray-400">No empty bottle data available.</td></tr>{% endfor %}
            </tbody></table></div>
        {% if total_bottle_pages > 1 %}
        <nav aria-label="Page navigation" class="mt-6 flex flex-col gap-2 align-center justify-center">
            <ul class="flex items-center justify-center space-x-1">
                <li>
                    {% if bottle_page > 1 %}
                        <a href="{{ pagination_base_url_bottle }}{{ query_params_bottle | to_querystring | update_querystring('bottle_page', bottle_page - 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </span>
                    {% endif %}
                </li>
                {% for p in range(max(1, bottle_page - 2), min(total_bottle_pages + 1, bottle_page + 3)) %}
                <li>
                    {% if p == bottle_page %}
                        <span class="px-3 py-2 text-sm leading-tight text-blue-600 bg-blue-50 border border-blue-300 font-medium dark:bg-gray-700 dark:border-gray-600 dark:text-white">{{ p }}</span>
                    {% else %}
                        <a href="{{ pagination_base_url_bottle }}{{ query_params_bottle | to_querystring | update_querystring('bottle_page', p) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">{{ p }}</a>
                    {% endif %}
                </li>
                {% endfor %}
                <li>
                    {% if bottle_page < total_bottle_pages %}
                        <a href="{{ pagination_base_url_bottle }}{{ query_params_bottle | to_querystring | update_querystring('bottle_page', bottle_page + 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </span>
                    {% endif %}
                </li>
            </ul>
            
            <div class="mt-4 text-sm text-gray-700 dark:text-gray-400 text-center">
                Showing page {{ bottle_page }} of {{ total_bottle_pages }}
            </div>
        </nav>
        {% endif %}
    </div>
    
    <!-- Section 4: Straw / Mist Heads Pack List -->
    <div class="bg-white dark:bg-gray-800 shadow-xl rounded-lg p-6 sm:p-8">
        <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200 mb-4">Straw / Mist Heads Pack List</h2>
        <button id="strawFilterToggleButton" class="w-full flex justify-between items-center py-3 px-4 text-left text-lg font-semibold text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700/50 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
            <span>Show/Hide Filters</span><svg id="strawFilterToggleIcon" class="w-5 h-5 transform transition-transform duration-200" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        </button>
        <div id="strawFilterFormContainer" class="hidden mb-6">
            <form method="get" action="{{ url_for('data_reports.pack_list') }}" class="space-y-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-4">
                    {% for name, label, placeholder, type in [
                        ('straw_month', 'Month', '10', 'text'), ('straw_year', 'Year', '2024', 'number'),
                        ('model_others', 'Model', 'ASH', 'text'), ('final_quantity', 'Final Quantity', '10', 'number'),
                        ('actual_quantity', 'Actual Quantity', '10', 'number'), ('extra', 'Extra', '10', 'number')
                    ] %}
                    <div><label for="straw_{{ name }}" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">{{ label }}</label><input type="{{ type }}" id="straw_{{ name }}" name="{{ name }}" value="{{ request.args.get(name, '') }}" placeholder="{{ placeholder }}" class="tailwind-input-class"></div>
                    {% endfor %}
                </div>
                <div class="pt-4 flex justify-end"><button type="submit" class="tailwind-button-blue">Filter Straw/Mist Heads</button></div>
            </form>
        </div>
        <div class="overflow-x-auto"><table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
            <thead class="bg-gray-50 dark:bg-gray-700"><tr>{% for header in ['Model', 'Final Quantity', 'Actual Quantity', 'Extra', 'Month', 'Year'] %}<th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider whitespace-nowrap">{{ header }}</th>{% endfor %}</tr></thead>
            <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
            {% for row in straw_data %}
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['model'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['final_quantity'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['actual_quantity'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['extra'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['month'] }}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-700 dark:text-gray-300">{{ row['year'] }}</td>
                </tr>
            {% else %}<tr><td colspan="6" class="px-6 py-4 whitespace-nowrap text-sm text-center text-gray-500 dark:text-gray-400">No straw/mist head data available.</td></tr>{% endfor %}
            </tbody></table></div>
        {% if total_straw_pages > 1 %}
        <nav aria-label="Page navigation" class="mt-6 flex flex-col gap-2 align-center justify-center">
            <ul class="flex items-center justify-center space-x-1">
                <li>
                    {% if straw_page > 1 %}
                        <a href="{{ pagination_base_url_straw }}{{ query_params_straw | to_querystring | update_querystring('straw_page', straw_page - 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Previous</span>
                            <i class="bi bi-chevron-left"></i>
                        </span>
                    {% endif %}
                </li>
                {% for p in range(max(1, straw_page - 2), min(total_straw_pages + 1, straw_page + 3)) %}
                <li>
                    {% if p == straw_page %}
                        <span class="px-3 py-2 text-sm leading-tight text-blue-600 bg-blue-50 border border-blue-300 font-medium dark:bg-gray-700 dark:border-gray-600 dark:text-white">{{ p }}</span>
                    {% else %}
                        <a href="{{ pagination_base_url_straw }}{{ query_params_straw | to_querystring | update_querystring('straw_page', p) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">{{ p }}</a>
                    {% endif %}
                </li>
                {% endfor %}
                <li>
                    {% if straw_page < total_straw_pages %}
                        <a href="{{ pagination_base_url_straw }}{{ query_params_straw | to_querystring | update_querystring('straw_page', straw_page + 1) }}" 
                           class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white transition-colors">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    {% else %}
                        <span class="px-3 py-2 text-sm leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-md cursor-not-allowed opacity-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400">
                            <span class="sr-only">Next</span>
                            <i class="bi bi-chevron-right"></i>
                        </span>
                    {% endif %}
                </li>
            </ul>
            
            <div class="mt-4 text-sm text-gray-700 dark:text-gray-400 text-center">
                Showing page {{ straw_page }} of {{ total_straw_pages }}
            </div>
        </nav>
        {% endif %}
    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
    // Common Tailwind classes (already defined in base.html or can be redefined if needed)
    const tailwindInputClass = "appearance-none block w-full px-3 py-2.5 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-indigo-500 dark:focus:ring-offset-gray-900 focus:border-indigo-500 sm:text-sm bg-white dark:bg-gray-700/50 text-gray-900 dark:text-gray-50";
    const tailwindButtonBlue = "py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-900";
    const tailwindPaginationButton = "py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white";
    const tailwindPaginationActive = "text-blue-600 bg-blue-50 border-blue-300 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white";
    const tailwindPaginationDisabled = "opacity-50 cursor-not-allowed";

    document.addEventListener('DOMContentLoaded', function () {
        function setupFilterToggle(buttonId, formContainerId, iconId) {
            const toggleButton = document.getElementById(buttonId);
            const formContainer = document.getElementById(formContainerId);
            const toggleIcon = document.getElementById(iconId);

            if (toggleButton && formContainer && toggleIcon) {
                // Set initial state based on whether any filters are active (optional)
                let params = new URLSearchParams(window.location.search);
                let filterActive = false;
                formContainer.querySelectorAll('input, select').forEach(input => {
                    if (params.has(input.name) && params.get(input.name) !== '') {
                        filterActive = true;
                    }
                });
                if (filterActive) {
                    formContainer.classList.remove('hidden');
                    toggleIcon.classList.add('rotate-180');
                }


                toggleButton.addEventListener('click', () => {
                    formContainer.classList.toggle('hidden');
                    toggleIcon.classList.toggle('rotate-180');
                });
            }
        }

        setupFilterToggle('eoFilterToggleButton', 'eoFilterFormContainer', 'eoFilterToggleIcon');
        setupFilterToggle('otherDeviceFilterToggleButton', 'otherDeviceFilterFormContainer', 'otherDeviceFilterToggleIcon');
        setupFilterToggle('bottleFilterToggleButton', 'bottleFilterFormContainer', 'bottleFilterToggleIcon');
        setupFilterToggle('strawFilterToggleButton', 'strawFilterFormContainer', 'strawFilterToggleIcon');

        // Apply common input class to all filter inputs
        document.querySelectorAll('form input, form select').forEach(el => {
             if (!el.classList.contains('tailwind-input-class') && el.type !== 'submit' && el.type !== 'button') {
                el.classList.add(...tailwindInputClass.split(' '));
            }
        });
        // Apply common button class to filter submit buttons
        document.querySelectorAll('form button[type="submit"]').forEach(el => {
            if (!el.classList.contains('tailwind-button-blue')) { // Basic check to avoid double styling
                el.classList.add(...tailwindButtonBlue.split(' '));
            }
        });

        // Redundant pagination styling JS removed. Styles are applied via Jinja macros/HTML.

    });
</script>
{% endblock %}
