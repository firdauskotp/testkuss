<script>

     // Add new contact and update numbering
        
        document.getElementById('addContactBtn').addEventListener('click', () => {
            contactCount++;
            const contactContainer = document.getElementById('contactContainer');
            const newContact = `
                <div class="contact-item mb-3" id="contact-${contactCount}">
                    <label class="form-label">PIC ${contactCount} - Name</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter name" required>
                    <input type="text" class="form-control mb-2" placeholder="Enter designation" required>
                    <input type="text" class="form-control mb-2" placeholder="Enter contact" required>
                    <input type="email" class="form-control mb-2" placeholder="Enter email" required>
                    <select class="form-select" required>
                        <option selected disabled>Tie contact to:</option>
                        ${getPremiseOptions()}
                    </select>
                    <button type="button" class="remove-btn mt-2">Remove</button>
                </div>
            `;
            contactContainer.insertAdjacentHTML('beforeend', newContact);
            updateContactNumbers();
        });

     document.getElementById('addDeviceBtn').addEventListener('click', () => {
            deviceCount++;
            const deviceContainer = document.getElementById('deviceContainer');
            const newDevice = `
                <div class="device-item mb-3" id="device-${deviceCount}">
                    <h5 class="section-heading">Device ${deviceCount}</h5>
                    <label class="form-label">#${deviceCount} Location</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter location" required>

                    <label class="form-label">#${deviceCount} S/N</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter serial number" required>

                    <label class="form-label">#${deviceCount} Model</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter model" required>

                    <label class="form-label">#${deviceCount} Volume Required</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter volume required" required>

                    <label class="form-label">#${deviceCount} Scent</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter scent" required>

                    <label class="form-label">Tie Device to Premise:</label>
                    <select class="form-select mb-2" required>
                        <option selected disabled>Select a premise</option>
                        ${getPremiseOptions()}
                    </select>

                    <!-- Events for Device -->
                    <h6 class="section-heading">Event 1</h6>
                    <label class="form-label">#${deviceCount} - E1 - Days</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter days" required>

                    <label class="form-label">#${deviceCount} - E1 - Start Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

                    <label class="form-label">#${deviceCount} - E1 - End Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

                    <label class="form-label">#${deviceCount} - E1 - Pause</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

                    <label class="form-label">#${deviceCount} - E1 - Work</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

                    <h6 class="section-heading">Event 2</h6>
                    <label class="form-label">#${deviceCount} - E2 - Days</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter days" required>

                    <label class="form-label">#${deviceCount} - E2 - Start Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

                    <label class="form-label">#${deviceCount} - E2 - End Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

                    <label class="form-label">#${deviceCount} - E2 - Pause</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

                    <label class="form-label">#${deviceCount} - E2 - Work</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

                    <h6 class="section-heading">Event 3</h6>
                    <label class="form-label">#${deviceCount} - E3 - Days</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter days" required>

                    <label class="form-label">#${deviceCount} - E3 - Start Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

                    <label class="form-label">#${deviceCount} - E3 - End Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

                    <label class="form-label">#${deviceCount} - E3 - Pause</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

                    <label class="form-label">#${deviceCount} - E3 - Work</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

                    <h6 class="section-heading">Event 4</h6>
                    <label class="form-label">#${deviceCount} - E4 - Days</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter days" required>

                    <label class="form-label">#${deviceCount} - E4 - Start Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

                    <label class="form-label">#${deviceCount} - E4 - End Time</label>
                    <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

                    <label class="form-label">#${deviceCount} - E4 - Pause</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

                    <label class="form-label">#${deviceCount} - E4 - Work</label>
                    <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

                    <button type="button" class="remove-btn mt-2">Remove Device</button>
                </div>`;
            deviceContainer.insertAdjacentHTML('beforeend', newDevice);
        });
</script>

//test combined containers
document.getElementById('combinedBtn').addEventListener('click', () => {
    contactCount++;
    const contactContainer = document.getElementById('contactContainer');
    const newContact = `
        <div class="contact-item mb-3" id="contact-${contactCount}">
            <label class="form-label">PIC ${contactCount} - Name</label>
            <input type="text" class="form-control mb-2" placeholder="Enter name" required>
            <input type="text" class="form-control mb-2" placeholder="Enter designation" required>
            <input type="text" class="form-control mb-2" placeholder="Enter contact" required>
            <input type="email" class="form-control mb-2" placeholder="Enter email" required>
            <select class="form-select" required>
                <option selected disabled>Tie contact to:</option>
                ${getPremiseOptions()}
            </select>
            <button type="button" class="remove-btn mt-2">Remove Contact and Device</button>
        </div>
    `;
    contactContainer.insertAdjacentHTML('beforeend', newContact);
    updateContactNumbers();

    deviceCount++;
    const deviceContainer = document.getElementById('deviceContainer');
    const newDevice = `
        <div class="device-item mb-3" id="device-${deviceCount}">
            <h5 class="section-heading">Device ${deviceCount}</h5>
            <label class="form-label">#${deviceCount} Location</label>
            <input type="text" class="form-control mb-2" placeholder="Enter location" required>

            <label class="form-label">#${deviceCount} S/N</label>
            <input type="text" class="form-control mb-2" placeholder="Enter serial number" required>

            <label class="form-label">#${deviceCount} Model</label>
            <input type="text" class="form-control mb-2" placeholder="Enter model" required>

            <label class="form-label">#${deviceCount} Volume Required</label>
            <input type="number" class="form-control mb-2" placeholder="Enter volume required" required>

            <label class="form-label">#${deviceCount} Scent</label>
            <input type="text" class="form-control mb-2" placeholder="Enter scent" required>

            <label class="form-label">Tie Device to Premise:</label>
            <select class="form-select mb-2" required>
                <option selected disabled>Select a premise</option>
                ${getPremiseOptions()}
            </select>

            <!-- Events for Device -->
            <h6 class="section-heading">Event 1</h6>
            <label class="form-label">#${deviceCount} - E1 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E1 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E1 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E1 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E1 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <h6 class="section-heading">Event 2</h6>
            <label class="form-label">#${deviceCount} - E2 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E2 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E2 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E2 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E2 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <h6 class="section-heading">Event 3</h6>
            <label class="form-label">#${deviceCount} - E3 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E3 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E3 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E3 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E3 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <h6 class="section-heading">Event 4</h6>
            <label class="form-label">#${deviceCount} - E4 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E4 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E4 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E4 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E4 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <button type="button" class="remove-btn mt-2">Remove Device and Contact</button>
        </div>`;
    deviceContainer.insertAdjacentHTML('beforeend', newDevice);
});

document.getElementById('combinedBtn2').addEventListener('click', () => {
    contactCount++;
    const contactContainer = document.getElementById('contactContainer');
    const newContact = `
        <div class="contact-item mb-3" id="contact-${contactCount}">
            <label class="form-label">PIC ${contactCount} - Name</label>
            <input type="text" class="form-control mb-2" placeholder="Enter name" required>
            <input type="text" class="form-control mb-2" placeholder="Enter designation" required>
            <input type="text" class="form-control mb-2" placeholder="Enter contact" required>
            <input type="email" class="form-control mb-2" placeholder="Enter email" required>
            <select class="form-select" required>
                <option selected disabled>Tie contact to:</option>
                ${getPremiseOptions()}
            </select>
            <button type="button" class="remove-btn mt-2">Remove</button>
        </div>
    `;
    contactContainer.insertAdjacentHTML('beforeend', newContact);
    updateContactNumbers();

    deviceCount++;
    const deviceContainer = document.getElementById('deviceContainer');
    const newDevice = `
        <div class="device-item mb-3" id="device-${deviceCount}">
            <h5 class="section-heading">Device ${deviceCount}</h5>
            <label class="form-label">#${deviceCount} Location</label>
            <input type="text" class="form-control mb-2" placeholder="Enter location" required>

            <label class="form-label">#${deviceCount} S/N</label>
            <input type="text" class="form-control mb-2" placeholder="Enter serial number" required>

            <label class="form-label">#${deviceCount} Model</label>
            <input type="text" class="form-control mb-2" placeholder="Enter model" required>

            <label class="form-label">#${deviceCount} Volume Required</label>
            <input type="number" class="form-control mb-2" placeholder="Enter volume required" required>

            <label class="form-label">#${deviceCount} Scent</label>
            <input type="text" class="form-control mb-2" placeholder="Enter scent" required>

            <label class="form-label">Tie Device to Premise:</label>
            <select class="form-select mb-2" required>
                <option selected disabled>Select a premise</option>
                ${getPremiseOptions()}
            </select>

            <!-- Events for Device -->
            <h6 class="section-heading">Event 1</h6>
            <label class="form-label">#${deviceCount} - E1 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E1 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E1 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E1 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E1 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <h6 class="section-heading">Event 2</h6>
            <label class="form-label">#${deviceCount} - E2 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E2 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E2 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E2 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E2 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <h6 class="section-heading">Event 3</h6>
            <label class="form-label">#${deviceCount} - E3 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E3 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E3 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E3 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E3 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <h6 class="section-heading">Event 4</h6>
            <label class="form-label">#${deviceCount} - E4 - Days</label>
            <input type="text" class="form-control mb-2" placeholder="Enter days" required>

            <label class="form-label">#${deviceCount} - E4 - Start Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter start time" required>

            <label class="form-label">#${deviceCount} - E4 - End Time</label>
            <input type="text" class="form-control mb-2" placeholder="Enter end time" required>

            <label class="form-label">#${deviceCount} - E4 - Pause</label>
            <input type="number" class="form-control mb-2" placeholder="Enter pause duration" required>

            <label class="form-label">#${deviceCount} - E4 - Work</label>
            <input type="number" class="form-control mb-2" placeholder="Enter work duration" required>

            <button type="button" class="remove-btn mt-2">Remove Device</button>
        </div>`;
    deviceContainer.insertAdjacentHTML('beforeend', newDevice);
});

# if premise_name and premise_area and premise_address:
#     premise_record = {
#         "company": companyName,
#         "month_year": dateCreated,
#         "industry": industry,
#         "premise_name": premise_name,
#         "premise_area": premise_area,
#         "premise_address": premise_address,
#         "contact_premise": contact_premise,
#         "created_at": datetime.now(),
#     }
#     premises.append(premise_record)
#     master_list.append(premise_record)

#     # Extract and store each PIC as a separate record
#     i = 1
#     while True:
#         pic_name = request.form.get(f'picName{i}')
#         pic_designation = request.form.get(f'picDesignation{i}')
#         pic_contact = request.form.get(f'picContact{i}')
#         pic_email = request.form.get(f'picEmail{i}')

#         if not pic_name:
#             break

#         pic_records.append({
#             "company": companyName,
#             "premise_name": premise_name,
#             "name": pic_name,
#             "designation": pic_designation,
#             "contact": pic_contact,
#             "email": pic_email,
#             "created_at": datetime.now(),
#         })
#         i += 1  # Move to the next PIC

#     # Extract and store each device with ALL schedules inside
#     j = 1
#     while True:
#         device_location = request.form.get(f'deviceLocation{j}')
#         device_sn = request.form.get(f'deviceSN{j}')
#         device_model = request.form.get(f'deviceModel{j}')
#         device_colour = request.form.get(f'deviceColour{j}')
#         device_volume = request.form.get(f'deviceVolume{j}')
#         device_scent = request.form.get(f'deviceScent{j}')

#         if not device_sn:
#             break

#         device_record = {
#             "company": companyName,
#             "premise_name": premise_name,
#             "location": device_location,
#             "S/N": device_sn,
#             "Model": device_model,
#             "Color": device_colour,
#             "Volume": device_volume,
#             "Current EO": device_scent,
#             "E1 - DAYS": request.form.get("E1Days"),
#             "E1 - START": request.form.get("E1StartTime"),
#             "E1 - END": request.form.get("E1EndTime"),
#             "E1 - PAUSE": request.form.get("E1Pause"),
#             "E1 - WORK": request.form.get("E1Work"),
#             "E2 - DAYS": request.form.get("E2Days"),
#             "E2 - START": request.form.get("E2StartTime"),
#             "E2 - END": request.form.get("E2EndTime"),
#             "E2 - PAUSE": request.form.get("E2Pause"),
#             "E2 - WORK": request.form.get("E2Work"),
#             "E3 - DAYS": request.form.get("E3Days"),
#             "E3 - START": request.form.get("E3StartTime"),
#             "E3 - END": request.form.get("E3EndTime"),
#             "E3 - PAUSE": request.form.get("E3Pause"),
#             "E3 - WORK": request.form.get("E3Work"),
#             "E4 - DAYS": request.form.get("E4Days"),
#             "E4 - START": request.form.get("E4StartTime"),
#             "E4 - END": request.form.get("E4EndTime"),
#             "E4 - PAUSE": request.form.get("E4Pause"),
#             "E4 - WORK": request.form.get("E4Work"),
#             "created_at": datetime.now(),
#         }
#         device_records.append(device_record)
#         master_list.append(device_record)


#         j += 1  # Move to the next device

 <!-- Main Navbar -->
  <!-- <nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNavbar" aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="mainNavbar">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('new_customer') }}">Add New Customer</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('change_form') }}">Change Form (Settings)</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('pre_service') }}">Pre-Service</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('service') }}">Service</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('post_service') }}">Post-Service</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('remark') }}">Remarks</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('register') }}">Add User</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('view_users') }}">View Customers</a></li>
          <li class="nav-item"><a class="nav-link" href="{{ url_for('view_admins') }}">View Admins</a></li>

          <li class="nav-item"><a class="nav-link" href="{{ url_for('get_logs') }}">Activity Log</a></li>

        </ul>
        <ul class="navbar-nav ml-auto">
         
          <li class="nav-item"><a class="nav-link logout-btn" href="/logout">Logout</a></li>
        </ul>
      </div>
    </div>
  </nav> -->

  # @app.route("/get_premises", methods=["POST"])
# def get_premises():
#     company_name = request.json.get("company_name")
#     company = services_collection.find_one({"name": company_name})
#     return jsonify(company.get("Premise Name", [])) if company else jsonify([])

# @app.route("/get_premises", methods=["GET"])
# def get_premises():
#     company_name = request.args.get("company_name")
#     if not company_name:
#         return jsonify([])  # Return an empty list if no company is selected
    
#     # Find premises for the selected company
#     premises = services_collection.find(
#         {"company": company_name},  # Filter by the selected company
#         {"premise": 1, "_id": 0}   # Fetch only the premise field
#     )
    
#     # Extract unique premises
#     unique_premises = sorted({premise.get("Premise Name") for premise in premises if "Premise Name" in premise})
#     return jsonify(unique_premises)

@app.route('/service')
def service():
    if "username" not in session:
        return redirect(url_for('admin_login'))
    companies = services_collection.distinct('company')
    if request.method == 'POST':
        # Get form data
        # data = request.json
        date_str = request.form.get('date')

        # Convert to datetime (ensuring correct format)
        # date_obj = datetime.strptime(date_str, "%Y-%m-%d")
        date_obj = datetime.fromisoformat(date_str.rstrip("Z")) if date_str else None


        # Prepare data for insertion
        entry = {
            "date": date_obj,
            "company": request.form.get('company'),
            "premise": request.form.get('premise'),
            "model": request.form.get('model'),
            "color": request.form.get('color'),
            "eo": request.form.get('eo')
        }
        route_list_collection.insert_one(entry)

        flash(f"Company: {request.form.get('company')}, Premise: {request.form.get('premise')} preservice added successfully!", "success")

        log_activity(session["username"],"pre-service : " +str(request.form.get('company')) + " : " +str(request.form.get('premise')),logs_collection)

        companies = services_collection.distinct('company')
        return render_template('service.html', companies=companies)
    # log_activity(session["username"],"service : " +str(remarks),logs_collection)

    return render_template('service.html',companies=companies)